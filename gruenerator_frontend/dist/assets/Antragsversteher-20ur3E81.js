import{v as f,c as G,u as U,w as O,j as t,E as $,B as H,P as R}from"./index-DyXXXUoc.js";import{b as a}from"./vendor-CPnJIadx.js";import{B as W}from"./BaseForm-c3ucbGGj.js";import{S as z}from"./AnimatedCheckbox-DTlO6gN8.js";import"./HelpDisplay-BuoYnQy0.js";import"./DisplaySection-B2S7b4Z_.js";import"./ActionButtons-D6KUb2mX.js";import"./index-CqWIjGOL.js";import"./index-02I5EOAM.js";function V(s){return f({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"},child:[]},{tag:"polyline",attr:{points:"13 2 13 9 20 9"},child:[]}]})(s)}function X(s){return f({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},child:[]},{tag:"polyline",attr:{points:"17 8 12 3 7 8"},child:[]},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"},child:[]}]})(s)}function _(s){return f({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"},child:[]},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"},child:[]}]})(s)}const q=({showHeaderFooter:s=!0})=>{const[B,v]=a.useState(!1),[p,r]=a.useState(""),[g,c]=a.useState(!1),[i,D]=a.useState(null),[F,m]=a.useState(!1),[w,k]=a.useState(""),[x,N]=a.useState(!1),[l,b]=a.useState(!1),E=a.useContext(G),{value:o,updateValue:d}=E||{},C=U(o,1.2,.8,[1e3,2e3]),S=a.useCallback(()=>{c(!1)},[]);a.useEffect(()=>{let e;return g&&(e=setTimeout(S,3e3)),()=>{e&&clearTimeout(e)}},[g,S]),a.useEffect(()=>{localStorage.getItem("termsAccepted")&&b(!0)},[]);const j=e=>e?e.type!=="application/pdf"?"Bitte wählen Sie eine PDF-Datei aus.":e.size>33554432?`Die Datei ist zu groß (${(e.size/(1024*1024)).toFixed(1)} MB). Maximale Größe ist 32 MB.`:null:"Bitte wählen Sie eine Datei aus.",y=a.useCallback(e=>{const n=j(e);if(n){r(n);return}console.log("Datei ausgewählt:",e.name),D(e),r(""),k(T(e.name))},[]),T=e=>{if(e.length<=20)return e;const n=e.split(".").pop();return e.substring(0,17)+"..."+n},A=e=>{e.preventDefault(),e.stopPropagation(),m(!0)},P=e=>{e.preventDefault(),e.stopPropagation(),m(!1)},L=e=>{e.preventDefault(),e.stopPropagation()},M=e=>{e.preventDefault(),e.stopPropagation(),m(!1);const n=e.dataTransfer.files;n.length&&y(n[0])},u=a.useCallback(()=>{D(null),k(""),d(""),r(""),c(!1)},[d]);a.useEffect(()=>()=>{u()},[u]);const I=a.useCallback(async()=>{if(!x){r("Bitte bestätigen Sie die Datenschutzerklärung.");return}if(!l){r("Bitte stimmen Sie den Nutzungsbedingungen zu.");return}const e=j(i);if(e){r(e);return}v(!0),r(""),c(!1);try{const n=new FormData;n.append("file",i);const h=await O.post("/api/antragsversteher/upload-pdf",n,{headers:{"Content-Type":"multipart/form-data"},timeout:3e5});if(h.data&&h.data.summary)d(h.data.summary),c(!0);else throw new Error("Unerwartete Serverantwort")}catch(n){console.error("Fehler beim Datei-Upload:",n),n.code==="ECONNABORTED"?r("Die Anfrage hat zu lange gedauert. Bitte versuchen Sie es erneut."):n.response&&n.response.status===400?r("Die hochgeladene Datei konnte nicht verarbeitet werden. Bitte stellen Sie sicher, dass es sich um ein gültiges PDF-Dokument handelt."):n.response&&n.response.status===413?r("Die Datei ist zu groß. Bitte laden Sie eine kleinere Datei hoch."):r("Ein unerwarteter Fehler ist aufgetreten. Bitte versuchen Sie es später erneut."),J(n)}finally{v(!1)}},[i,d,x,l]);return t.jsx($,{children:t.jsx("div",{className:`container ${s?"with-header":""} antragsversteher-container ${o?"has-content":""}`,children:t.jsxs(W,{title:o?"Analyse":"Grünerator Antragscheck",onSubmit:I,loading:B,success:g,error:p||void 0,generatedContent:o,textSize:C,submitButtonText:i?H.SUBMIT:"Bitte wählen Sie eine PDF-Datei aus",generatedPost:"",allowEditing:!1,onReset:u,children:[t.jsx("h3",{children:!o&&"Grünerator Antragscheck"}),t.jsx("p",{className:"explanation-text",children:"Lade hier deinen Antrag als PDF-Datei hoch. Der Grünerator analysiert den Text und gibt dir eine Einschätzung aus grüner Perspektive."}),p&&t.jsx("div",{className:"error-message",children:p}),t.jsxs("div",{className:`file-upload-area ${F?"dragging":""}`,onDragEnter:A,onDragLeave:P,onDragOver:L,onDrop:M,children:[t.jsx("input",{type:"file",onChange:e=>y(e.target.files[0]),accept:"application/pdf",style:{display:"none"},id:"file-input"}),i&&t.jsx("button",{className:"file-reset-button",onClick:e=>{e.preventDefault(),u()},"aria-label":"Datei entfernen",children:t.jsx(_,{size:16})}),t.jsx("label",{htmlFor:"file-input",className:"file-upload-label",children:i?t.jsxs(t.Fragment,{children:[t.jsx(V,{size:24}),t.jsx("span",{className:"file-name",children:w})]}):t.jsxs(t.Fragment,{children:[t.jsx(X,{size:24,className:"upload-icon"}),t.jsx("span",{children:"PDF-Datei hier ablegen oder klicken zum Auswählen (max. 32 MB)"})]})})]}),t.jsx("div",{className:"privacy-checkbox-container",children:t.jsxs("div",{className:"checkbox-with-text",children:[t.jsx(z,{id:"privacy-checkbox",checked:x,onChange:e=>N(e.target.checked),label:"",variant:"simple"}),t.jsxs("span",{className:"checkbox-text",children:["Ich bestätige, dass ich keine personenbezogenen oder vertraulichen Daten eingebe und bin damit einverstanden, dass die Daten entsprechend der ",t.jsx("a",{href:"/datenschutz#nutzungsbedingungen",className:"terms-link",children:"Nutzungsbedingungen"})," des Grünerators von Anthropic verarbeitet und 28 Tage gespeichert werden."]})]})}),!l&&t.jsx("div",{className:"terms-checkbox-container",children:t.jsxs("div",{className:"checkbox-with-text",children:[t.jsx(z,{id:"terms-checkbox",checked:l,onChange:e=>{b(e.target.checked),e.target.checked&&localStorage.setItem("termsAccepted","true")},label:"",variant:"simple"}),t.jsxs("span",{className:"checkbox-text",children:["Ich stimme den"," ",t.jsx("a",{href:"/datenschutz#nutzungsbedingungen",className:"terms-link",children:"Nutzungsbedingungen"})," ","zu."]})]})})]})})})};q.propTypes={showHeaderFooter:R.bool};function J(s){console.error("Fehler aufgetreten:",s)}export{q as default};
