import{j as e,P as i,b as S,E as R}from"./index-DyXXXUoc.js";import{b as m}from"./vendor-CPnJIadx.js";import{d as E}from"./index-02I5EOAM.js";import{A as C,f as L}from"./ActionButtons-D6KUb2mX.js";import"./index-CqWIjGOL.js";const A=[{icon:"üö≤",text:"Verkehrswende in Kommunen Beispiele"},{icon:"üåç",text:"Klimaschutz f√ºr Kommunen Ideen"}],g=({onSearch:a,loading:r,value:t,onChange:n})=>{const c=s=>{s.preventDefault(),t.trim()&&!r&&a(t.trim())};return e.jsx("div",{className:"search-bar-container",children:e.jsxs("form",{onSubmit:c,className:"search-form",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("input",{type:"text",value:t,onChange:s=>n(s.target.value),className:"search-input","aria-label":"Suchfeld",disabled:r}),e.jsx("button",{type:"submit",className:"search-icon-button",disabled:r||!t.trim(),"aria-label":"Suchen",children:r?e.jsx("div",{className:"button-spinner"}):e.jsx(E,{className:"search-icon"})})]}),e.jsx("div",{className:"ai-disclaimer",children:"KI-Systeme k√∂nnen Fakten falsch interpretieren oder erfinden. Bitte pr√ºfe die Quellen."}),e.jsx("div",{className:"example-questions",children:A.map((s,l)=>e.jsxs("button",{type:"button",className:"example-question",onClick:()=>n(s.text),children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.text})]},l))})]})})};g.propTypes={onSearch:i.func.isRequired,loading:i.bool,value:i.string,onChange:i.func};g.defaultProps={loading:!1,value:"",onChange:()=>{}};const k=(a,r,t)=>{const n=/(https?:\/\/[^\s)]+)/g,c=[...new Set(r.match(n)||[])];return a.filter(s=>{const l=c.some(o=>s.url.includes(o)||o.includes(s.url)),u=s.title&&(r.toLowerCase().includes(s.title.toLowerCase().substring(0,Math.min(s.title.length,40)))||t.some(o=>o.toLowerCase().includes(s.title.toLowerCase())||s.title.toLowerCase().includes(o.toLowerCase())));return l||u})},q=a=>a.split(`

`).map(t=>t.includes("<")?t:`<p>${t}</p>`).join(""),_=()=>{const[a,r]=m.useState([]),[t,n]=m.useState([]),[c,s]=m.useState(null),[l,u]=m.useState(null),[o,f]=m.useState([]),{submitForm:p,loading:x}=S("search"),{submitForm:j,loading:b}=S("analyze"),w=m.useCallback(async N=>{u(null),s(null),n([]),f([]);try{const d=await p({query:N,options:{search_depth:"advanced",max_results:10,include_raw_content:!0}});if(d.status==="success"&&Array.isArray(d.results)){r(d.results);try{const h=await j({contents:d.results.slice(0,6)});s(q(h.analysis)),f(h.sourceRecommendations||[]);const v=k(d.results.slice(0,6),h.analysis,h.claudeSourceTitles);n(v)}catch(h){console.error("Analyse fehlgeschlagen:",h),u("Die Analyse konnte nicht durchgef√ºhrt werden, aber hier sind die Suchergebnisse.")}}else throw new Error("Ung√ºltiges Antwortformat vom Server")}catch(d){u(d.message),r([])}},[p,j]);return{results:a,usedSources:t,analysis:c,loading:x||b,error:l,search:w,sourceRecommendations:o}};i.func.isRequired;const B=a=>{try{return new URL(a).hostname.replace(/^www\./,"")}catch{return a}},y=({sources:a,title:r,recommendations:t=[]})=>e.jsxs("div",{className:"sources-container",children:[e.jsx("h2",{children:r}),e.jsx("div",{className:"sources-list",children:a.map((n,c)=>{const s=t.find(l=>l.title===n.title);return e.jsxs("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"source-item",children:[e.jsx("h3",{children:n.title}),s&&e.jsx("div",{className:"source-recommendation",children:e.jsx("p",{className:"source-summary",children:s.summary})}),e.jsx("span",{className:"source-url",children:B(n.url)})]},c)})})]});y.propTypes={sources:i.arrayOf(i.shape({url:i.string.isRequired,title:i.string.isRequired})).isRequired,title:i.string.isRequired,recommendations:i.arrayOf(i.shape({title:i.string.isRequired,summary:i.string.isRequired}))};const U=()=>{const[a,r]=m.useState(""),{results:t,usedSources:n,analysis:c,loading:s,error:l,search:u,sourceRecommendations:o=[]}=_(),f=async x=>{await u(x)},p=t.filter(x=>!n.some(j=>j.url===x.url));return e.jsx(R,{children:e.jsxs("div",{className:"search-page-container",children:[e.jsxs("div",{className:"search-header",children:[e.jsx("h1",{children:"Gruugo"}),e.jsx("p",{className:"search-subtitle",children:"KI-Suche des Gr√ºnerators"})]}),e.jsx(g,{onSearch:f,loading:s,value:a,onChange:r}),l&&e.jsx("div",{className:"search-error",children:l}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"analysis-container",children:[e.jsx("div",{className:"analysis-actions",children:e.jsx(C,{content:L({analysis:c,sourceRecommendations:o,unusedSources:t}),onEdit:()=>{},isEditing:!1,allowEditing:!1,hideEditButton:!0,showExport:!0})}),e.jsx("div",{className:"analysis-content",dangerouslySetInnerHTML:{__html:c}})]}),e.jsxs("div",{className:"sources-section",children:[n.length>0&&e.jsx(y,{sources:n,title:"Verwendete Quellen",recommendations:o}),p.length>0&&e.jsx(y,{sources:p,title:"Erg√§nzende Informationen",recommendations:o})]})]})]})})};export{U as default};
