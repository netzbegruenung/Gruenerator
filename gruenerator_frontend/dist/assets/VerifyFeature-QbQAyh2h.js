import{d as V,j as e,P as o}from"./index-DyXXXUoc.js";import{b as r,d as E}from"./vendor-CPnJIadx.js";const j=({closed:i})=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:i?e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}):e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})});j.propTypes={closed:o.bool};function L({feature:i,children:w,onVerified:d,onCancel:h}){const[v,k]=r.useState(""),[x,n]=r.useState(""),[c,N]=r.useState(!1),[g,f]=r.useState(0),[m,y]=r.useState(0),[a,b]=r.useState(!1),{verifyPassword:A,isFeatureVerified:S}=V(),P=E(),l=3,p=300;r.useEffect(()=>{let s;return m>0&&(s=setInterval(()=>{y(t=>t<=1?(b(!1),f(0),0):t-1)},1e3)),()=>clearInterval(s)},[m]);const F=async s=>{if(s.preventDefault(),n(""),a){n(`Bitte warten Sie noch ${Math.ceil(m)} Sekunden`);return}try{if(await A(v,i))f(0),d&&d();else{const u=g+1;f(u),u>=l?(b(!0),y(p),n(`Zu viele fehlgeschlagene Versuche. Bitte warten Sie ${p/60} Minuten.`),console.log(`Fehlgeschlagene Anmeldeversuche für Feature ${i} - Account gesperrt für ${p/60} Minuten`)):(n(`Falsches Passwort. Noch ${l-u} Versuche übrig`),console.log(`Fehlgeschlagener Anmeldeversuch für Feature ${i} - Versuch ${u} von ${l}`))}}catch{n("Ein Fehler ist aufgetreten")}},T=()=>{h?h():P("/")},$=()=>{N(!c)},M=()=>e.jsx("div",{className:"verify-attempts",children:[...Array(l)].map((s,t)=>e.jsx("div",{className:`attempt-dot ${t<g?"failed":"active"}`},t))});return S(i)&&!d?w:e.jsx("div",{className:"verify-container",children:e.jsxs("div",{className:`verify-box ${a?"locked":""}`,children:[e.jsx("h2",{children:"Zugriff verifizieren"}),e.jsx("p",{children:"Diese Funktion erfordert eine Verifizierung."}),e.jsxs("form",{onSubmit:F,className:"verify-form",children:[e.jsxs("div",{className:"verify-input-group",children:[e.jsx("input",{type:c?"text":"password",value:v,onChange:s=>k(s.target.value),placeholder:"Passwort eingeben",className:"verify-input",disabled:a}),e.jsx("button",{type:"button",onClick:$,className:"verify-password-toggle","aria-label":c?"Passwort verbergen":"Passwort anzeigen",disabled:a,children:e.jsx(j,{closed:!c})})]}),M(),x&&e.jsx("div",{className:"verify-error",children:x}),e.jsxs("div",{className:"verify-buttons",children:[e.jsx("button",{type:"button",onClick:T,className:"verify-button verify-button-secondary",children:h?"Abbrechen":"Zurück"}),e.jsx("button",{type:"submit",className:"verify-button",disabled:a,children:"Verifizieren"})]})]})]})})}L.propTypes={feature:o.string.isRequired,children:o.node.isRequired,onVerified:o.func,onCancel:o.func};export{L as V};
