import{j as g,P as _,b as D,F as j,a as L,E as B}from"./index-DyXXXUoc.js";import{b as t}from"./vendor-CPnJIadx.js";import{B as $}from"./BaseForm-c3ucbGGj.js";import{P as Y}from"./DisplaySection-B2S7b4Z_.js";import{H as V}from"./HelpDisplay-BuoYnQy0.js";import"./ActionButtons-D6KUb2mX.js";import"./index-CqWIjGOL.js";import"./index-02I5EOAM.js";const k=t.createContext(),K=({children:a})=>{const[c,E]=t.useState({idee:"",details:"",gliederung:""}),[m,h]=t.useState(!1),[w,N]=t.useState([]),[l,y]=t.useState(""),[A,d]=t.useState(""),[o,F]=t.useState(""),[n,p]=t.useState(!1),[u,G]=t.useState(null),f={formData:c,setFormData:E,useWebSearch:m,setUseWebSearch:h,searchResults:w,setSearchResults:N,generatedAntrag:l,setGeneratedAntrag:y,displayedSearchResults:A,setDisplayedSearchResults:b=>{console.log("[AntragContext] Setze displayedSearchResults:",b?b.substring(0,100)+"...":"leer"),d(b)},displayedSources:o,setDisplayedSources:b=>{console.log("[AntragContext] Setze displayedSources:",b?b.substring(0,100)+"...":"leer"),F(b)},loading:n,setLoading:p,error:u,setError:G};return g.jsx(k.Provider,{value:f,children:a})};K.propTypes={children:_.node.isRequired};const H=()=>{const a=t.useContext(k);if(!a)throw new Error("useAntragContext must be used within an AntragProvider");return a},q=()=>{const a=D("claude/search-query"),c=D("search"),E=D("claude/antrag"),m=D("claude/antrag-simple");return{searchQuerySubmit:a,searchSubmit:c,antragSubmit:E,simpleAntragSubmit:m}},s={IDLE:"IDLE",GENERATING_QUERY:"GENERATING_QUERY",SEARCHING:"SEARCHING",GENERATING_ANTRAG:"GENERATING_ANTRAG",DONE:"DONE",ERROR:"ERROR"},J=()=>{const[a,c]=t.useState([]),[E,m]=t.useState(null),[h,w]=t.useState(""),[N,l]=t.useState(s.IDLE),y=D("claude/search-query"),A=D("search"),d=n=>n?(console.log("Verarbeite Suchanfrage:",n),typeof n=="string"?n.trim():n.content?n.content.trim():n.searchQuery?n.searchQuery.trim():(console.error("Keine gültige Suchanfrage in der Antwort gefunden:",n),null)):(console.error("Keine Antwort erhalten"),null),o=t.useCallback(async n=>{var p,u,G,C;m(null),l(s.GENERATING_QUERY);try{if(!n.idee)throw new Error("Bitte gib eine Idee ein");const i=await y.submitForm({idee:n.idee,details:n.details||"",gliederung:n.gliederung||""}),f=d(i);if(!f)throw new Error("Keine Suchanfrage generiert");return w(f),l(s.DONE),i}catch(i){console.error("[useAntragSearch] Error bei Suchanfrage:",i);const f=((u=(p=i.response)==null?void 0:p.data)==null?void 0:u.error)||((C=(G=i.response)==null?void 0:G.data)==null?void 0:C.message)||i.message||"Ein Fehler ist aufgetreten";throw m(f),l(s.ERROR),i}},[y]),F=t.useCallback(async n=>{var p,u,G,C;m(null),l(s.SEARCHING);try{if(!n)throw new Error("Keine Suchanfrage vorhanden");console.log("[useAntragSearch] Starte Suche mit Anfrage:",n);const i=await A.submitForm({query:n.trim(),options:{search_depth:"advanced",max_results:5,include_raw_content:!0}});console.log("[useAntragSearch] Suchantwort erhalten:",i);const f=(i==null?void 0:i.results)||[];if(!Array.isArray(f)||f.length===0)throw console.warn("[useAntragSearch] Keine Suchergebnisse gefunden"),new Error("Keine Suchergebnisse gefunden");const b=f.map(x=>({title:x.title||"",content:x.content||x.snippet||"",url:x.url||"",score:x.score||0}));return console.log("[useAntragSearch] Normalisierte Ergebnisse:",b),c(b),l(s.DONE),{query:n,results:b}}catch(i){console.error("[useAntragSearch] Fehler bei Suche:",i);const f=((u=(p=i.response)==null?void 0:p.data)==null?void 0:u.error)||((C=(G=i.response)==null?void 0:G.data)==null?void 0:C.message)||i.message||"Ein Fehler ist aufgetreten";throw m(f),l(s.ERROR),i}},[A]);return{searchResults:a,searchQuery:h,error:E,generateSearchQuery:o,performSearch:F,loading:y.loading||A.loading,searchState:N}},X=a=>Array.isArray(a)?a:a&&Array.isArray(a.results)?a.results:[],Z=()=>{const[a,c]=t.useState(s.IDLE),[E,m]=t.useState(""),{formData:h,setFormData:w,useWebSearch:N,setGeneratedAntrag:l,setDisplayedSearchResults:y,setDisplayedSources:A,setLoading:d,setError:o,loading:F}=H(),{antragSubmit:n,simpleAntragSubmit:p}=q(),{generateSearchQuery:u,performSearch:G,searchResults:C,error:i}=J(),f=t.useCallback((e,r)=>{w(R=>({...R,[e]:r}))},[w]),b=t.useCallback(e=>{e&&(m(e),console.log("[useAntrag] Formatierte Suchanfrage:",e),l(""),A(""))},[y,l,A]),x=t.useCallback(e=>{if(!e)return"";if(e.startsWith("PRESSEMITTEILUNG:")||e.startsWith("Betreff:")||e.startsWith("ANTRAG:"))return console.log("[useAntrag] Antrag hat bereits einen Header:",e.substring(0,50)+"..."),e;const r=`ANTRAG: 

${e}`;return console.log("[useAntrag] Formatierter Antrag:",r.substring(0,50)+"..."),r},[]),O=t.useCallback(e=>{if(!e||!Array.isArray(e)||e.length===0){console.warn("[useAntrag] Keine Quellen zum Anzeigen vorhanden");return}const r=e.map((R,S)=>{const I=R.title||"Quelle",Q=R.link||R.url||"";return`[${S+1}] ${I}
${Q}
`}).join(`
`);console.log("[useAntrag] Formatierte Quellen:",r.substring(0,100)+"..."),A(r)},[A]),z=t.useCallback(e=>{if(!e||!e.results||!Array.isArray(e.results)||e.results.length===0){console.warn("[useAntrag] Keine Suchergebnisse zum Anzeigen vorhanden:",e);return}console.log("[useAntrag] Suchergebnisse erhalten:",e.results.length)},[A]),T=t.useCallback(async e=>{var R;const r=X(e);if(r.length===0)throw console.error("[useAntrag] Ungültige Suchergebnisse:",e),new Error("Keine Suchergebnisse vorhanden");d(!0),o(null),c(s.GENERATING_ANTRAG);try{console.log("[useAntrag] Generiere Antrag mit Suchergebnissen:",r);const S=await n.submitForm({idee:h.idee,details:h.details,gliederung:h.gliederung,searchResults:r,useWebSearch:!0});console.log("[useAntrag] Antwort vom Backend mit Websuche:",S);let I;if(typeof S=="string")I=S;else if(S!=null&&S.content)I=S.content;else if((R=S==null?void 0:S.metadata)!=null&&R.content)I=S.metadata.content;else throw new Error("Kein Antrag generiert");y("");const Q=x(I);return l(Q),O(r),c(s.DONE),I}catch(S){throw console.error("[useAntrag] Fehler bei der Antragsgenerierung mit Suchergebnissen:",S),o(S.message||"Ein Fehler ist aufgetreten"),c(s.ERROR),S}finally{d(!1)}},[h,n,x,O,l,d,o,y,A]),v=t.useCallback(async e=>{if(!e)throw new Error("Keine Suchanfrage vorhanden");d(!0),o(null),c(s.SEARCHING);try{console.log("[useAntrag] Starte Suche für:",e);const r=await G(e);if(r&&r.results&&Array.isArray(r.results)){console.log("[useAntrag] Suchergebnisse erhalten:",r.results.length);try{console.log("[useAntrag] Starte automatisch Antragsgenerierung mit Suchergebnissen"),await T(r.results)}catch(R){console.error("[useAntrag] Fehler bei automatischer Antragsgenerierung:",R),o(R.message||"Fehler bei der automatischen Antragsgenerierung")}}else console.warn("[useAntrag] Keine Ergebnisse in der Antwort gefunden:",r),o("Keine Suchergebnisse gefunden");return c(s.DONE),r}catch(r){throw console.error("[useAntrag] Fehler bei der Suche:",r),o(r.message||"Fehler bei der Suche"),c(s.ERROR),r}finally{d(!1)}},[G,z,d,o,T]),W=t.useCallback(async()=>{d(!0),o(null),c(s.GENERATING_QUERY);try{console.log("[useAntrag] Generiere Suchanfrage mit Formdata:",h);const e=await u(h);if(!e)throw new Error("Keine Antwort bei Suchanfragengeneration erhalten");const r=e.content||e;if(!r)throw new Error("Keine Suchanfrage wurde generiert");console.log("[useAntrag] Generierte Suchanfrage:",r),b(r),A("");try{console.log("[useAntrag] Starte automatische Suche mit Anfrage:",r),await v(r)}catch(R){console.error("[useAntrag] Fehler bei automatischer Suche:",R),o(R.message||"Fehler bei der automatischen Suche")}return c(s.DONE),r}catch(e){throw console.error("[useAntrag] Fehler bei Generierung der Suchanfrage:",e),o(e.message||"Ein Fehler ist aufgetreten"),c(s.ERROR),e}finally{d(!1)}},[h,u,b,v,d,o,A]),U=t.useCallback(async()=>{if(N)return console.log("[useAntrag] Starte automatisierten Prozess (Suchanfrage → Suche → Antrag)"),W();d(!0),o(null);try{if(console.log("[useAntrag] Starte vereinfachte Antragsgenerierung ohne Websuche"),!h.idee)throw new Error("Bitte gib eine Idee ein");const e=await p.submitForm(h);return e&&l(e),e}catch(e){console.error("[useAntrag] Fehler:",e),o(e.message||"Ein Fehler ist aufgetreten")}finally{d(!1)}},[h,N,p,W,l,d,o]),M=e=>e.length>40?e.substring(0,40)+"...":e;return{formData:h,handleInputChange:f,generateAntrag:U,executeSearch:v,generateAntragWithSearchResults:T,searchQuery:E,searchResults:C,searchState:a,statusMessage:(()=>{switch(a){case s.GENERATING_QUERY:return"Generiere Suchanfrage...";case s.SEARCHING:return(E==null?void 0:E.length)>30?`Suche: ${E.substring(0,30)}...`:`Suche: ${E}`;case s.GENERATING_ANTRAG:return"Erstelle Antrag...";case s.ERROR:return M(i||"Fehler");default:return""}})(),loading:F,error:i||n.error}},ee=()=>{const{formData:a,handleInputChange:c,generateAntrag:E,searchState:m,statusMessage:h,loading:w,error:N}=Z(),{generatedAntrag:l,setGeneratedAntrag:y,useWebSearch:A,setUseWebSearch:d,displayedSources:o}=H(),F=async()=>{try{await E()}catch(u){console.error("[AntragForm] Fehler beim Generieren des Antrags:",u)}},n=t.useCallback(u=>{console.log("[AntragForm] Generierter Inhalt geändert:",u?u.substring(0,100)+"...":"leer"),y(u)},[y]),p=()=>{if(w){if(m===s.GENERATING_QUERY)return"Recherchiere...";if(m===s.SEARCHING)return"Recherchiere...";if(m===s.GENERATING_ANTRAG)return"Antrag wird generiert..."}return"Antrag generieren"};return g.jsxs("div",{className:"container with-header",children:[g.jsxs($,{title:"Grünerator für Anträge",onSubmit:F,loading:w,error:N,generatedContent:l,onGeneratedContentChange:n,allowEditing:!0,submitButtonProps:{statusMessage:w?h:"",showStatus:!0,defaultText:p(),loading:w},usePlatformContainers:!0,disableAutoCollapse:!0,featureToggle:{isActive:A,onToggle:d,label:"Webrecherche aktivieren",icon:V,description:"Aktiviere die automatische Webrecherche, um relevante Informationen zu deinem Antrag zu finden und einzubinden.",isSearching:m===s.SEARCHING,statusMessage:h},useFeatureToggle:!0,children:[g.jsx("h3",{children:g.jsx("label",{htmlFor:"idee",children:j.IDEE})}),g.jsx("input",{id:"idee",type:"text",value:a.idee,onChange:u=>c("idee",u.target.value),placeholder:L.IDEE,required:!0}),g.jsx("h3",{children:g.jsx("label",{htmlFor:"details",children:j.DETAILS})}),g.jsx("textarea",{id:"details",value:a.details,onChange:u=>c("details",u.target.value),placeholder:L.DETAILS,style:{height:"120px"}}),g.jsx("h3",{children:g.jsx("label",{htmlFor:"gliederung",children:j.GLIEDERUNG})}),g.jsx("input",{id:"gliederung",type:"text",value:a.gliederung,onChange:u=>c("gliederung",u.target.value),placeholder:L.GLIEDERUNG})]}),o&&o.trim()!==""&&l&&l.trim()!==""&&g.jsxs("div",{className:"sources-container",children:[g.jsx("h3",{children:"Quellen"}),g.jsx(Y,{content:`QUELLEN: 

${o}`})]})]})},P=({showHeaderFooter:a=!0})=>g.jsx("div",{className:a?"with-header":"no-header",children:g.jsx(B,{children:g.jsx(K,{children:g.jsx(ee,{})})})});P.propTypes={showHeaderFooter:_.bool};P.defaultProps={showHeaderFooter:!0};export{P as AntragPage,P as default};
